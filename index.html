<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Punk Link — Tech Radar</title>
  <style>
    :root{--bg:#0f1720;--ring:#334155;--accent:#06b6d4;--muted:#94a3b8;--label:#e6eef6}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--label);font-family:Inter, system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial}
    .wrap{display:flex;flex-direction:column;min-height:100vh}
    header{padding:18px 22px;border-bottom:1px solid rgba(255,255,255,0.03);display:flex;align-items:center;gap:18px}
    header h1{margin:0;font-size:18px}
    .controls{margin-left:auto;display:flex;gap:8px;align-items:center}
    select,input[type="search"]{background:rgba(255,255,255,0.02);border:1px solid rgba(255,255,255,0.04);color:var(--label);padding:6px 8px;border-radius:6px}
    main{flex:1;display:flex;align-items:center;justify-content:center;padding:18px}
    #radar{width:min(1100px,96vw);height:min(860px,85vh);background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);border-radius:12px;padding:12px;box-sizing:border-box;position:relative}
    svg{width:100%;height:100%;display:block}
    .legend{position:absolute;right:18px;top:72px;background:rgba(0,0,0,0.3);padding:8px;border-radius:8px;font-size:13px;color:var(--muted)}
    a.entry{fill:none;stroke:none;cursor:pointer}
    .node{font-size:12px;pointer-events:auto}
    .tooltip{position:fixed;z-index:50;pointer-events:none;background:#0b1220;border:1px solid rgba(255,255,255,0.06);padding:8px;border-radius:6px;color:var(--label);font-size:13px;max-width:320px}
    .footer{padding:10px 22px;border-top:1px solid rgba(255,255,255,0.03);font-size:13px;color:var(--muted)}
    @media (max-width:640px){#radar{height:calc(100vh - 160px)}header{flex-wrap:wrap}}
    .chip{display:inline-block;background:rgba(255,255,255,0.04);padding:2px 6px;border-radius:999px;margin-right:6px;font-size:12px;color:var(--muted)}
  </style>
</head>
<body> 
  <div class="wrap">
    <header>
      <h1>Punk Link — Tech Radar</h1>
      <div class="controls" aria-hidden="false">
        <label for="category">Category:</label>
        <select id="category" aria-label="Filter by category">
          <option value="">All</option>
        </select>
        <label for="search">Search:</label>
        <input id="search" type="search" placeholder="filter by label or tag" aria-label="Search label or tag">
        <button id="reset" title="Reset filters" aria-label="Reset filters">Reset</button>
      </div>
    </header>

    <main>
      <div id="radar" role="img" aria-label="Tech Radar">
        <svg id="svg"></svg>
        <div class="legend" id="legend"></div>
      </div>
    </main>

    <div class="footer">Data: <code>radar/data.json</code> — Edit and push to update. This site can be published via GitHub Pages.</div>
  </div>

  <div id="tip" class="tooltip" style="display:none"></div>

  <script>
    // Deterministic RNG from string (mulberry32)
    function hashStringToSeed(s){let h=2166136261;for(let i=0;i<s.length;i++){h^=s.charCodeAt(i);h+= (h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24)}return h>>>0}
    function mulberry32(a){return function(){a |= 0; a = a + 0x6D2B79F5 | 0; var t = Math.imul(a ^ a >>> 15, 1 | a); t = t + Math.imul(t ^ t >>> 7, 61 | t) ^ t; return ((t ^ t >>> 14) >>> 0) / 4294967296;}}

    // DOM helpers
    const tip = document.getElementById('tip');
    function showTip(ev, entry){
      tip.style.display='block';
      const tags = (entry.tags||[]).map(t=>`<span class="chip">${t}</span>`).join(' ');
      tip.innerHTML = `<strong>${entry.label}</strong> <div style="color:#9fb4c8;margin-top:6px">${entry.description||''}</div><div style="margin-top:6px;color:#9fb4c8;font-size:12px">Category: ${entry.category || '—'}</div><div style="margin-top:6px">${tags}</div>`;
      moveTip(ev);
    }
    function moveTip(ev){const pad=12; tip.style.left = (ev.clientX + pad) + 'px'; tip.style.top = (ev.clientY + pad) + 'px'}
    function hideTip(){tip.style.display='none'}

    // Draw radar with optional filter
    function drawRadar(data, filterFn = ()=>true){
      const svg = document.getElementById('svg'); while(svg.firstChild) svg.removeChild(svg.firstChild);
      const W = svg.clientWidth, H = svg.clientHeight; const cx = W/2, cy = H/2;
      const outer = Math.min(W,H) * 0.45;
      const rings = data.rings.length;
      const ringStep = outer / rings;

      // Rings + labels
      for(let r=1;r<=rings;r++){
        const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
        circle.setAttribute('cx',cx); circle.setAttribute('cy',cy); circle.setAttribute('r',r*ringStep);
        circle.setAttribute('fill','none'); circle.setAttribute('stroke','rgba(255,255,255,0.03)');
        circle.setAttribute('stroke-width', r===rings?1:0.5);
        svg.appendChild(circle);

        const label = document.createElementNS('http://www.w3.org/2000/svg','text');
        label.setAttribute('x', cx+6); label.setAttribute('y', cy - r*ringStep + 14);
        label.setAttribute('fill','rgba(255,255,255,0.25)'); label.setAttribute('font-size','12');
        label.textContent = data.rings[r-1];
        svg.appendChild(label);
      }

      // Quadrant lines + labels
      const quads = data.quadrants.length;
      for(let q=0;q<quads;q++){
        const angle = (q*2+1)/quads * Math.PI/2;
        const x = cx + Math.cos(angle)*outer*1.05;
        const y = cy + Math.sin(angle)*outer*1.05;
        const line = document.createElementNS('http://www.w3.org/2000/svg','line');
        line.setAttribute('x1',cx); line.setAttribute('y1',cy); line.setAttribute('x2',x); line.setAttribute('y2',y);
        line.setAttribute('stroke','rgba(255,255,255,0.03)'); line.setAttribute('stroke-width',0.6);
        svg.appendChild(line);

        const t = document.createElementNS('http://www.w3.org/2000/svg','text');
        t.setAttribute('x', cx + Math.cos(angle)*(outer*0.6)); t.setAttribute('y', cy + Math.sin(angle)*(outer*0.6));
        t.setAttribute('fill','rgba(255,255,255,0.4)'); t.setAttribute('font-size','14'); t.setAttribute('text-anchor','middle');
        t.textContent = data.quadrants[q];
        svg.appendChild(t);
      }

      // Entries
      (data.entries||[]).filter(filterFn).forEach(entry=>{
        const qIndex = Math.max(0, data.quadrants.indexOf(entry.quadrant));
        const rIndex = Math.max(0, data.rings.indexOf(entry.ring));
        const seed = hashStringToSeed((entry.id||'') + '::' + (entry.label||''));
        const rnd = mulberry32(seed);
        const minR = rIndex*ringStep*0.2;
        const maxR = (rIndex+1)*ringStep - ringStep*0.2;
        const radius = minR + rnd()*(maxR-minR);
        const angleStart = (qIndex * Math.PI/2) + 0.08;
        const angleEnd = ((qIndex+1) * Math.PI/2) - 0.08;
        const angle = angleStart + rnd()*(angleEnd-angleStart);
        const x = cx + Math.cos(angle)*radius;
        const y = cy + Math.sin(angle)*radius;

        const g = document.createElementNS('http://www.w3.org/2000/svg','a');
        if(entry.url) g.setAttribute('href', entry.url);
        g.setAttribute('class','entry'); g.setAttribute('target','_blank');

        const circle = document.createElementNS('http://www.w3.org/2000/svg','circle');
        circle.setAttribute('cx',x); circle.setAttribute('cy',y); circle.setAttribute('r',8);
        circle.setAttribute('fill','#06b6d4'); circle.setAttribute('opacity','0.95');
        circle.setAttribute('stroke','#0b1220'); circle.setAttribute('stroke-width','1'); circle.setAttribute('data-id',entry.id);

        const text = document.createElementNS('http://www.w3.org/2000/svg','text');
        text.setAttribute('x', x+12); text.setAttribute('y', y+4); text.setAttribute('fill','white'); text.setAttribute('font-size','12');
        text.textContent = entry.label;

        g.appendChild(circle); g.appendChild(text); svg.appendChild(g);

        circle.addEventListener('mouseenter', (ev)=>showTip(ev, entry));
        circle.addEventListener('mousemove', (ev)=>moveTip(ev));
        circle.addEventListener('mouseleave', hideTip);
      });

      // Legend
      const legend = document.getElementById('legend'); legend.innerHTML = '';
      legend.innerHTML = `<strong>Rings</strong><br>` + data.rings.map((r,i)=>`<div style="margin-top:6px"><span style='display:inline-block;width:10px;height:10px;background:rgba(255,255,255,0.06);margin-right:8px;border-radius:2px;'></span>${i+1}. ${r}</div>`).join('');
    }

    // UI wiring
    async function init(){
      try{
        const resp = await fetch('data.json');
        if(!resp.ok) throw new Error('data.json not found');
        const data = await resp.json();

        // populate categories select
        const sel = document.getElementById('category');
        (data.categories || []).forEach(c=>{
          const opt = document.createElement('option'); opt.value = c; opt.textContent = c; sel.appendChild(opt);
        });

        const search = document.getElementById('search');
        const reset = document.getElementById('reset');

        function filterFnFactory(){
          const category = sel.value;
          const term = (search.value || '').trim().toLowerCase();
          return function(entry){
            if(category && entry.category !== category) return false;
            if(!term) return true;
            if((entry.label||'').toLowerCase().includes(term)) return true;
            if((entry.tags||[]).some(t=>t.toLowerCase().includes(term))) return true;
            return false;
          };
        }

        function redraw(){
          drawRadar(data, filterFnFactory());
        }

        sel.addEventListener('change', redraw);
        search.addEventListener('input', debounce(redraw, 200));
        reset.addEventListener('click', ()=>{
          sel.value=''; search.value=''; redraw();
        });

        // initial draw
        drawRadar(data);
        window.addEventListener('resize', ()=>drawRadar(data, filterFnFactory()));
      }catch(e){
        const svg=document.getElementById('svg'); svg.innerHTML = '<text x="10" y="20" fill="#fca5a5">Could not load radar/data.json — ' + e.message + '</text>';
      }
    }

    // utility debounce
    function debounce(fn, wait){
      let t; return function(...a){clearTimeout(t); t=setTimeout(()=>fn.apply(this,a), wait);};
    }

    init();
  </script>
</body>
</html>